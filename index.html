<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR.js Ground Recognition</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mayognaise/aframe-gesture-detector-component/dist/aframe-gesture-detector.min.js"></script>
    <style>
        #rotateRightButton, #rotateUpButton, #resetButton, #screenshotButton {
            position: absolute;
            z-index: 1;
            width: 50px;
            height: 50px;
            background-size: cover;
            border: none;
            cursor: pointer;
        }
        #rotateRightButton {
            top: 10px;
            left: 10px;
            background-image: url('rotateRightButton.png');
        }
        #rotateUpButton {
            top: 70px;
            left: 10px;
            background-image: url('rotateUpButton.png');
        }
        #resetButton {
            top: 130px;
            left: 10px;
            background-image: url('resetButton.png');
        }
        #screenshotButton {
            top: 10px;
            right: 10px;
            background-image: url('screenshotButton.png');
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene vr-mode-ui="enabled: false;" embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <!-- 地面認識に基づいて3Dモデルを表示 -->
        <a-entity id="arModel" 
                  gltf-model="url(cube.glb)" 
                  scale="0.1 0.1 0.1" 
                  position="0 0 -2" 
                  rotation="45 45 0"
                  gesture-detector>
        </a-entity>
        <a-entity camera></a-entity>
    </a-scene>

    <button id="rotateRightButton"></button>
    <button id="rotateUpButton"></button>
    <button id="resetButton"></button>
    <button id="screenshotButton"></button>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const model = document.getElementById('arModel');
            let initialPosition = model.getAttribute('position'); // 初期位置を記憶
            let rotateInterval;

            // 右回転ボタンの長押し処理
            document.getElementById('rotateRightButton').addEventListener('mousedown', function() {
                rotateInterval = setInterval(function() {
                    let rotation = model.getAttribute('rotation');
                    rotation.y += 1; // 少しずつ右回転
                    model.setAttribute('rotation', rotation);
                }, 50); // 50msごとに回転
            });

            document.getElementById('rotateRightButton').addEventListener('mouseup', function() {
                clearInterval(rotateInterval);
            });

            document.getElementById('rotateRightButton').addEventListener('mouseleave', function() {
                clearInterval(rotateInterval);
            });

            // 上回転ボタンの長押し処理
            document.getElementById('rotateUpButton').addEventListener('mousedown', function() {
                rotateInterval = setInterval(function() {
                    let rotation = model.getAttribute('rotation');
                    rotation.x += 1; // 少しずつ上回転
                    model.setAttribute('rotation', rotation);
                }, 50); // 50msごとに回転
            });

            document.getElementById('rotateUpButton').addEventListener('mouseup', function() {
                clearInterval(rotateInterval);
            });

            document.getElementById('rotateUpButton').addEventListener('mouseleave', function() {
                clearInterval(rotateInterval);
            });

            // ドラッグとピンチ操作を利用して移動と拡大縮小を実装
            model.addEventListener('gesture-swipe', function(event) {
                let position = model.getAttribute('position');
                position.x += event.detail.direction === 'right' ? 0.1 : -0.1;
                model.setAttribute('position', position);
            });

            model.addEventListener('gesture-pinch', function(event) {
                let scale = model.getAttribute('scale');
                scale.x *= event.detail.scale;
                scale.y *= event.detail.scale;
                scale.z *= event.detail.scale;
                model.setAttribute('scale', scale);
            });

            // リセットボタンの処理
            document.getElementById('resetButton').addEventListener('click', function() {
                model.setAttribute('position', initialPosition);
                model.setAttribute('rotation', {x: 45, y: 45, z: 0});
            });

            // スクリーンショットモード (ボタンを隠す)
            document.getElementById('screenshotButton').addEventListener('click', function() {
                document.getElementById('rotateRightButton').style.display = 'none';
                document.getElementById('rotateUpButton').style.display = 'none';
                document.getElementById('resetButton').style.display = 'none';
                document.getElementById('screenshotButton').style.display = 'none';
                setTimeout(() => {
                    document.getElementById('rotateRightButton').style.display = 'block';
                    document.getElementById('rotateUpButton').style.display = 'block';
                    document.getElementById('resetButton').style.display = 'block';
                    document.getElementById('screenshotButton').style.display = 'block';
                }, 3000); // 3秒後にボタンを再表示
            });
        });
    </script>
</body>
</html>
